# 🎉 版本发布：v1.2.0

**发布日期**：2026-02-22
**版本类型**：功能更新 (Feature Release)

---

## 📦 版本信息

### 主仓库
- **版本号**：v1.2.0
- **提交数**：12 个
- **标签**：`v1.2.0`
- **远程仓库**：https://github.com/WardLu/wiznote-to-obsidian

### 子模块 (app/ → shadow-shift)
- **版本号**：v1.1.0
- **提交数**：9 个
- **标签**：`v1.1.0`
- **远程仓库**：https://github.com/WardLu/shadow-shift (Private)

---

## ✨ 主要功能

### 1. 登录验证 ✅

**功能描述**：
- 在迁移前验证为知笔记账号密码
- 显示具体的错误信息（如"用户名或密码错误"）
- 登录失败时弹窗提示用户
- 阻止后续迁移流程

**实现方式**：
- `WizMigrator.login()` 返回 `(success, error_message)` 元组
- GUI 捕获错误信息并显示

**效果**：
```
输入错误密码 → 日志显示"❌ 登录失败：用户名或密码错误"
            → 弹窗提示
            → 阻止迁移
```

---

### 2. 单实例检查 ✅

**功能描述**：
- 使用文件锁防止重复打开应用
- 同一时间只能运行一个实例
- 友好的错误提示
- 退出时自动清理锁文件

**实现方式**：
- 使用 `fcntl.flock()` 锁定文件
- 锁文件：`/tmp/wiznote_to_obsidian.lock`
- `atexit` 注册清理函数

**效果**：
```
应用已在运行 → 提示"❌ 应用已在运行中"
            → 阻止启动
```

---

### 3. 实时进度更新 ✅

**功能描述**：
- 进度条实时更新百分比
- 进度文本显示：`下载中 X/Y (Z%)`
- 用户清楚看到迁移进度

**实现方式**：
- `WizMigrator.__init__()` 添加 `on_progress` 回调
- 每个笔记下载完成后调用回调
- GUI 通过 `self.root.after()` 更新界面

**效果**：
```
进度条：████████░░░░░░░░ 40%
进度文本：下载中 40/100 (40%)
```

---

### 4. 实时日志显示 ✅

**功能描述**：
- 迁移日志同时输出到命令行和 GUI
- GUI 操作日志区域实时滚动显示
- 方便调试和用户查看

**实现方式**：
- `GUILogRedirector` 类重定向 `stdout`
- 使用 `contextlib.redirect_stdout`
- 同时写入原始 `sys.stdout` 和 GUI

**效果**：
```
命令行：
[1/100] ✅ 成功: 笔记标题1
[2/100] ✅ 成功: 笔记标题2
...

GUI 操作日志：
[1/100] ✅ 成功: 笔记标题1
[2/100] ✅ 成功: 笔记标题2
...
```

---

### 5. 依赖检查 ✅

**功能描述**：
- 启动时自动检查依赖项
- 必需依赖缺失时阻止启动
- 可选依赖缺失时显示警告
- 提示安装命令

**检查内容**：
- **必需依赖**：customtkinter, markdownify, requests
- **可选依赖**：websocket-client（协作笔记功能）

**效果**：
```
缺少必需依赖：
❌ 缺少必需的依赖项：
   - customtkinter

💡 安装命令：
   pip3 install --break-system-packages -r requirements.txt
```

---

## 🎨 UI/UX 改进

### 苹果极简风格

**设计特点**：
- 深色背景：`#1a1a2e`
- 圆角卡片设计：`corner_radius=8`
- 渐变色按钮：`#00d9ff`
- 紧凑布局：优化间距和排版

**视觉效果**：
```
┌─────────────────────────────────┐
│            📝                   │
│  为知笔记 → Obsidian 一键迁移    │
├─────────────────────────────────┤
│  为知笔记登录                    │
│  ┌───────────────────────────┐  │
│  │ 手机号/邮箱                │  │
│  └───────────────────────────┘  │
│  ┌───────────────────────────┐  │
│  │ 密码                       │  │
│  └───────────────────────────┘  │
├─────────────────────────────────┤
│  🚀 一键迁移                    │
└─────────────────────────────────┘
```

---

## 🐛 Bug 修复

### 1. 修复 GUI 启动崩溃

**问题**：系统 Tk 与 macOS 15.7.3 不兼容，导致 Python 崩溃

**解决方案**：
- 使用 Homebrew Python 3.12
- `run_gui.sh` 指定 `/opt/homebrew/bin/python3.12`

---

### 2. 修复 signal 错误

**问题**：`signal only works in main thread of the main interpreter`

**原因**：`signal.SIGALRM` 只能在主线程使用，但迁移在后台线程运行

**解决方案**：移除 `signal` 超时机制，保留 HTTP 请求级别的超时

---

### 3. 修复日志不显示

**问题**：命令行没有输出，只有 GUI 有日志

**解决方案**：`GUILogRedirector` 同时输出到命令行和 GUI

---

## 🚀 使用方式

### 启动应用

```bash
cd "/Users/wardlu/Documents/VibeCoding/Wiznote to Obsidian"
./start.sh
```

### 测试功能

1. **测试登录验证**：
   - 输入错误的账号密码
   - 点击"一键迁移"
   - 应该看到弹窗："登录失败：用户名或密码错误"

2. **测试单实例**：
   - 保持第一个窗口打开
   - 再次运行 `./start.sh`
   - 应该看到提示："❌ 应用已在运行中"

3. **测试进度更新**：
   - 输入正确的账号密码
   - 观察进度条和进度文本实时更新

---

## 📊 项目统计

### 代码变更

| 类别 | 数量 |
|-----|------|
| 主仓库提交 | 12 个 |
| 子模块提交 | 9 个 |
| 修改文件 | 5 个核心文件 |
| 新增文件 | 3 个文档文件 |
| 代码行数（新增/修改） | ~500 行 |

### 文件修改详情

| 文件 | 修改内容 |
|-----|---------|
| `tools/wiznote_downloader.py` | 登录返回错误信息、添加进度回调 |
| `app/src/main.py` | 单实例检查、依赖检查 |
| `app/src/gui/app.py` | 登录验证、进度更新、日志重定向、UI 恢复 |
| `app/run_gui.sh` | 启动脚本、依赖检查 |
| `start.sh` | 便捷启动脚本 |

---

## 📝 文档更新

### 新增文档

- ✅ **ARCHITECTURE.md** - Git Submodule 架构说明
- ✅ **COMMIT_REPORT.md** - 详细的提交记录和测试报告
- ✅ **app/CHANGELOG.md** - 子模块更新日志

### 更新文档

- 📝 **CHANGELOG.md** - 添加 v1.2.0 更新内容
- 📝 **README.md** - 更新使用说明（如有）

---

## 🎯 下一步计划

### v1.2.1 (计划中)
- [ ] 优化卡顿问题（最后两个笔记卡住）
- [ ] 添加取消迁移功能
- [ ] 更详细的统计信息

### v1.3.0 (未来)
- [ ] 迁移历史记录
- [ ] 导出迁移报告
- [ ] 自定义输出目录

### v2.0.0 (未来)
- [ ] 支持 Windows 和 Linux
- [ ] 批量账号管理
- [ ] 云端同步
- [ ] 自定义转换规则

---

## 📞 反馈与支持

### 问题反馈
- **GitHub Issues**: https://github.com/WardLu/wiznote-to-obsidian/issues
- **私有仓库**: https://github.com/WardLu/shadow-shift (需要权限)

### 技术支持
- 查看 `README.md` 获取使用说明
- 查看 `ARCHITECTURE.md` 了解架构设计
- 查看 `COMMIT_REPORT.md` 了解技术细节

---

## 🙏 致谢

感谢所有参与测试和反馈的用户！

---

**发布时间**：2026-02-22 00:00:00
**发布人**：Claude + WardLu
**版本状态**：✅ 稳定版本，可正常使用
